(function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],l=0,d=[];l<s.length;l++)a=s[l],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&d.push(i[a][0]),i[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);p&&p(t);while(d.length)d.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,a=1;a<n.length;a++){var s=n[a];0!==i[s]&&(r=!1)}r&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={index:0},i={index:0},o=[];function s(e){return c.p+"js/"+({main:"main","pwa-electron":"pwa-electron",sentry:"sentry",welcome:"welcome","settings~users":"settings~users",settings:"settings",users:"users",share:"share",stream:"stream"}[e]||e)+"."+{main:"27934e56","pwa-electron":"445fc57e",sentry:"aa18ab35",welcome:"a1780c50","settings~users":"c2cfa694",settings:"f1a17285",users:"8d3fcc4f",share:"3dd477d3",stream:"28095053"}[e]+".js"}function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={main:1,welcome:1,"settings~users":1,settings:1,users:1,share:1,stream:1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var r="css/"+({main:"main","pwa-electron":"pwa-electron",sentry:"sentry",welcome:"welcome","settings~users":"settings~users",settings:"settings",users:"users",share:"share",stream:"stream"}[e]||e)+"."+{main:"c1ca7f8d","pwa-electron":"31d6cfe0",sentry:"31d6cfe0",welcome:"7ab2094d","settings~users":"87b251bc",settings:"9919a4c4",users:"c0c2cc51",share:"a2d8861f",stream:"77d5a56b"}[e]+".css",i=c.p+r,o=document.getElementsByTagName("link"),s=0;s<o.length;s++){var u=o[s],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===r||l===i))return t()}var d=document.getElementsByTagName("style");for(s=0;s<d.length;s++){u=d[s],l=u.getAttribute("data-href");if(l===r||l===i)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var r=t&&t.target&&t.target.src||i,o=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=r,delete a[e],p.parentNode.removeChild(p),n(o)},p.href=i;var m=document.getElementsByTagName("head")[0];m.appendChild(p)})).then((function(){a[e]=0})));var r=i[e];if(0!==r)if(r)t.push(r[2]);else{var o=new Promise((function(t,n){r=i[e]=[t,n]}));t.push(r[2]=o);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=s(e);var d=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(p);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",d.name="ChunkLoadError",d.type=r,d.request=a,n[1](d)}i[e]=void 0}};var p=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var p=l;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0a62":function(e,t,n){"use strict";n.d(t,"k",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return f})),n.d(t,"g",(function(){return b})),n.d(t,"i",(function(){return v})),n.d(t,"h",(function(){return h})),n.d(t,"j",(function(){return g}));n("5319"),n("ac1f"),n("4d63"),n("25f0"),n("841c"),n("2b3d"),n("d3b7"),n("3ca3"),n("ddb0"),n("159b");var r=function(e,t,n,r,a,i,o){this.wsUri=e,this.logindata={},this.logindata.type="login",this.logindata.roomid=a,this.logindata.pid=554,this.logindata.user_name=t,this.logindata.nick_name=n,this.logindata.pass_word=r,this.logindata.mobile=2,this.logindata.state=0,this.logindata.level=i,this.logindata.vod="",this.logindata.avatar=o},a=5;r.prototype.connect=function(){var e=this;e.reconnectMs=2e3,e.wsmsg=new WebSocket(this.wsUri),e.wsmsg.onopen=function(t){e.wsmsg.send(JSON.stringify(e.logindata))},e.wsmsg.onerror=function(e){console.log("WsClient: onerror")},e.wsmsg.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(i){return void console.log("This doesn't look like a valid JSON: ",t.data)}switch(n.type){case"adduserlist":break;case"login":var r={type:"get_top_list"};e.wsmsg.send(JSON.stringify(r));break;case"alert":break;case"state":break;case"on_hand":break;case"disconnect":break;case"public_message":break;case"system_message":break;case"Kick_out":break;case"online_list":break;case"on_addfile":r={type:"get_file_list"};e.wsmsg.send(JSON.stringify(r));break;case"on_delfile":r={type:"get_file_list"};e.wsmsg.send(JSON.stringify(r));case"get_file_list":break;case"set_topfile":break;case"get_top_list":break;case"draw_message":break;case"ovmeet_message":break;case"usermute":break;case"userhand":break;default:n.type="default";break}var a=new CustomEvent(n.type,{detail:n});e.wsmsg.dispatchEvent(a)},e.wsmsg.onclose=function(){console.log("WsClient: Connection closed "+a),a>0&&(setTimeout((function(){e.connect()}),2e3),a--);var t={type:"disconnect"};t.user_name=e.logindata.user_name;var n=new CustomEvent(t.type,{detail:t});e.wsmsg.dispatchEvent(n)}},r.prototype.disconnect=function(){this.reconnt=0,this.wsmsg.close()},r.prototype.send=function(e){this.wsmsg.send(JSON.stringify(e))};var i=function(e,t,n,r,a){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&r(i.responseText)};var s=o(a,t);i.open(e,s,!0),i.setRequestHeader("Content-Type","application/json"),void 0!==n?i.send(JSON.stringify(n)):i.send()};var o=function(e,t){var n;if(void 0!==e)n=e+t;else{var r="https://"+location.host+"/",a=new URL(r);n=a.origin+t}return n},s=function(e){e||console.info("Null")};function c(e,t,n,a,i){var o="wss://"+window.location.host,s=t,c=n,u=a,l="avatar.png",d=i,p=new r(o,s,c,u,e,d,l);return p.connect(),p}function u(e,t,n,r,a,o){i("GET","/setusermute/"+e+"/"+t+"/"+n+"/"+r,(function(e){a(e)}),o)}function l(e,t,n,r,a){i("GET","/setuserhand/"+e+"/"+t+"/"+n,(function(e){r(e)}),a)}function d(e,t,n,r,a,o){i("GET","/killuser/"+e+"/"+r,(function(e){a(e)}),o)}function p(e,t,n,r){i("DELETE","/stopstreamin/"+e+"/"+n,s,r)}function m(e,t,n,r){var a=[];a.push({op:"replace",path:"/info/layout/0/stream",value:t}),i("PATCH","/rooms/"+e+"/streams/"+n,a,s,r)}function f(e,t,n,r){var a=[];n.forEach((function(e){a.push({op:"replace",path:"/info/layout",value:e})})),i("PATCH","/rooms/"+e+"/streams/"+t,a,s,r)}function b(e,t,n,r,a,o){var s={name:t,custompath:n,loop:1,auto:1,tasks:[{explain:t,transtype:r,src:e}]};i("POST","/api/push/add/",s,a,o)}function v(e,t,n){var r=e,a={address:encodeURI(r)};i("POST","/api/push/remove/",a,t,n)}function h(e,t,n){i("GET","/sig/pubstart/?app="+e+"&stream="+t,void 0,s,n)}function g(e,t,n){i("GET","/sig/pubstop/?app="+e+"&stream="+t,void 0,s,n)}},"0ab5":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n("53ca");n("13d5"),n("4de4"),n("b64b"),n("159b"),n("99af"),n("caad"),n("d3b7"),n("25f0");function a(e){try{return"object"===Object(r["a"])(e)?JSON.parse(JSON.stringify(e)):e}catch(t){log("cloneObject error:",t)}return null}function i(e,t){var n=function(e){return e&&"object"===Object(r["a"])(e)};return n(e)&&n(t)?(Object.keys(t).forEach((function(r){var a=e[r],o=t[r];Array.isArray(a)&&Array.isArray(o)?e[r]=a.concat(o):n(a)&&n(o)?e[r]=i(Object.assign({},a),o):e[r]=o})),e):t}function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==e?t:["1","true","yes"].includes(e.toString().toLocaleLowerCase())}},"28b0":function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return p}));n("d3b7"),n("3ca3"),n("ddb0");var r=n("2b0e"),a=n("db49"),i=n("a23e"),o=n("34eb")("app:bugs");function s(e){a["c"]&&a["g"]&&u()&&(console.log("Sentry bug tracking is allowed"),n.e("sentry").then(n.bind(null,"011e")).then((function(t){var n=t.setupSentry;n({dsn:a["g"],Vue:r["default"]}),console.log("Did init Sentry bug tracking"),e&&e()})))}var c=[];function u(){var e;return"1"===(null===(e=localStorage)||void 0===e?void 0:e.allowSentry)}function l(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Reload to activate changes";o("setAllowedBugTracking",e),e?(localStorage.allowSentry="1",s((function(e){var t;o("setupBugTracker",c);while(t=c.pop())o("send error",t),d(t)}))):(localStorage.allowSentry="0",confirm(t)&&location.reload())}function d(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||console.error("Exception:",e),window.sentry?(o("sentry exception",e),window.sentry.captureException(e)):(c.push(e),i["b"].emit("requestBugTracking"))}function p(e){console.error(e),d(e,!0)}},"34bb":function(e,t){e.exports=require("electron")},3504:function(e){e.exports=JSON.parse('{"welcome":{"start":"开始聊天","abstract":"安全的点对点的群组聊天工具","help":"了解更多","created":"作者:"},"share":{"title":"邀请","link_info":"请您通过此链接邀请参加此会议的所有人：","button_copy":"分享","qr_info":"您也可以使用移动设备摄像头扫描此二维码：","feedback":"有问题请反馈到<a href=\\"mailto:1410919373@qq.com\\">1410919373@qq.com</a>","message":"通过按下 $symbol$ 来发送邀请朋友加入群聊"},"settings":{"title":"设置","video":"视频来源","audio":"音频来源","desktop":"共享屏幕或窗口","blur":"模糊背景","blur_info":"实验性的：一种智能的人工智能算法能够识别人的形状，并模糊掉其余的背景。这为您的通话增加了一些视觉隐私。但是请注意，这是一个非常耗电的功能，很可能无法在移动设备上使用！ ","bandwidth":"应用带宽优化 ","bandwidth_info":"实验性：使用此设置，“简报”尝试通过稀疏视频和音频数据来减少带宽。 ","fill":"放大视频","fill_info":"简报试图通过以使视频适合其视觉框架的方式缩放视频来尽可能地利用可用的屏幕空间。关闭后，您会看到整个视频，但周围带有边框。","subscribe":"订阅这个房间","subscribe_info":"实验性的：通过订阅，当其他人进入这个房间时，您会收到通知。然后，您可以一键加入对话。仅在浏览器正在运行时显示通知。 ","sentry":"允许错误跟踪","sentry_info":"当遇到编程错误或其他对改善应用程序有用的相关信息时，我们会将调试数据发送到<a href=\\"https://www.ovsyun.com\\">www.ovsyun.com</a>.","sentry_confirm":"感谢您允许错误跟踪。请确认立即重新加载页面。","background":"背景","persist_settings":"持续设置","original_background":"原始背景","blurred_background":"模糊背景","image_background":"图片背景","image_tip":"您可以通过在此窗口上拖动图像文件来上传自己的背景。","random_image":"单击以获取另一个随机图像。"}}')},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("d3b7"),n("3ca3"),n("ddb0"),n("466d"),n("ac1f");var r=n("2b0e"),a=(n("db49"),n("0ab5"));function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lang,n=e.locales,r=void 0===n?{en:{}}:n,i=e.defaultLang,o=void 0===i?"zh":i;return t="zh",Object(a["c"])(Object(a["c"])({},r[o]),r[t]||{})}var o,s,c,u,l={install:function(e,t){e.mixin({data:function(){return{l:i(t)}}})}},d=n("3504"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return null==e.state.room?n("app-welcome",{staticClass:"app"}):n("app-main")},m=[],f=n("34eb")("app:pwa-app"),b={name:"App",components:{AppWelcome:function(){return n.e("welcome").then(n.bind(null,"ee5b"))},AppMain:function(){return n.e("main").then(n.bind(null,"8cd5"))}},data:function(){return{}},mounted:function(){f("pwa")}},v=b,h=(n("74f5"),n("2877")),g=Object(h["a"])(v,p,m,!1,null,null,null),_=g.exports,w=n("faae"),y=n("5c96"),S=n.n(y);n("0fae");r["default"].use(S.a),navigator.userAgent.toLowerCase().indexOf(" electron/")>-1&&null==window.beaker&&(console.log("Identified Electron"),n.e("pwa-electron").then(n.bind(null,"0f3b")).then(),console.log("Handled Electron")),window.iOS=null!=(null===(o=navigator)||void 0===o||null===(s=o.platform)||void 0===s?void 0:s.match(/(iPhone|iPod|iPad)/i)),window.iPhone=null!=(null===(c=navigator)||void 0===c||null===(u=c.platform)||void 0===u?void 0:u.match(/(iPhone|iPod)/i)),window.iPhone&&console.log("Identified Phone of a native app"),r["default"].config.productionTip=!1,r["default"].mixin({data:function(){return{state:w["b"]}},methods:{openExternalLink:function(e){if(window.electron){var t;if("string"===typeof e)t=e;else{var n,r=null===e||void 0===e?void 0:e.target;while(r&&null==(null===(a=r)||void 0===a?void 0:a.href)){var a;r=r.parentElement}t=null===(n=r)||void 0===n?void 0:n.href}return console.info("Open external link",e.target),t&&window.electron.shell.openExternal(t),e.preventDefault(),!1}return!0}}}),r["default"].use(l,{locales:{zh:d}}),new r["default"]({render:function(e){return e(_)}}).$mount("#app")},"74f5":function(e,t,n){"use strict";n("95df")},"95df":function(e,t,n){},a23e:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u}));var r=n("d4ec"),a=n("bee2"),i=n("ade3"),o=(n("4de4"),n("28b0")),s=n("34eb")("app:emitter"),c=function(){function e(){Object(r["a"])(this,e),Object(i["a"])(this,"subscribers",{})}return Object(a["a"])(e,[{key:"emit",value:function(e,t){try{for(var n=this.subscribers[e]||[],r=0;r<n.length;r++){var a=n[r];try{a(t)}catch(i){console.warn("emit warning:",i),Object(o["d"])(i)}}}catch(i){console.error("emit exception",i),Object(o["d"])(i)}}},{key:"on",value:function(e,t){var n=this,r=this.subscribers[e]||[];return r.push(t),this.subscribers[e]=r,{cleanup:function(){n.off(e,t)}}}},{key:"off",value:function(e,t){s("off",e),this.subscribers=(this.subscribers[e]||[]).filter((function(e){return t&&e!==t}))}}]),e}(),u=new c},db49:function(e,t,n){"use strict";n.d(t,"n",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"h",(function(){return p})),n.d(t,"i",(function(){return m})),n.d(t,"j",(function(){return f})),n.d(t,"k",(function(){return b})),n.d(t,"l",(function(){return v})),n.d(t,"m",(function(){return h}));var r=n("0ab5"),a="wss://192.168.1.199:4444",i={iceTransportPolicy:"all",reconnectTimer:3e3,iceServers:[{urls:"stun:49.12.77.1:5349"},{urls:"turn:49.12.77.1:5349",username:"brie",credential:"fi"}]},o=!1,s=!o,c="ViMeet@2.19.6",u="",l="https://"+location.host+"/?room=",d=Object({NODE_ENV:"production",VUE_APP_AUTHOR_EMAIL:"dirk.holtwick@gmail.com",VUE_APP_AUTHOR_NAME:"Dirk Holtwick",VUE_APP_DEBUG_DEFAULT_ROOM:"development",VUE_APP_NAME:"ViMeet",VUE_APP_RELEASE:"ViMeet@2.19.6",VUE_APP_SENTRY_DSN:"",VUE_APP_SHOW_FULLSCREEN:"1",VUE_APP_SHOW_INVITATION:"1",VUE_APP_SHOW_INVITATION_HINT:"1",VUE_APP_SHOW_SETTINGS:"1",VUE_APP_SHOW_SHARE:"1",VUE_APP_SIGNAL_URL:"wss://192.168.1.199:4444",VUE_APP_STUN_URL:"stun:49.12.77.1:5349",VUE_APP_TURN_PASSWORD:"fi",VUE_APP_TURN_URL:"turn:49.12.77.1:5349",VUE_APP_TURN_USER:"brie",VUE_APP_UNSPLASH_API:"",VUE_APP_UNSPLASH_SECRET:"",VUE_APP_VERSION:"2.19.6",BASE_URL:"/"}).VUE_APP_ROOM_PATH||"/vvvv/",p=Object(r["b"])("1",!0),m=Object(r["b"])("1",!0),f=Object(r["b"])("1",!0),b=Object(r["b"])("1",!0),v=Object(r["b"])("1",!0),h=Object(r["b"])(Object({NODE_ENV:"production",VUE_APP_AUTHOR_EMAIL:"dirk.holtwick@gmail.com",VUE_APP_AUTHOR_NAME:"Dirk Holtwick",VUE_APP_DEBUG_DEFAULT_ROOM:"development",VUE_APP_NAME:"ViMeet",VUE_APP_RELEASE:"ViMeet@2.19.6",VUE_APP_SENTRY_DSN:"",VUE_APP_SHOW_FULLSCREEN:"1",VUE_APP_SHOW_INVITATION:"1",VUE_APP_SHOW_INVITATION_HINT:"1",VUE_APP_SHOW_SETTINGS:"1",VUE_APP_SHOW_SHARE:"1",VUE_APP_SIGNAL_URL:"wss://192.168.1.199:4444",VUE_APP_STUN_URL:"stun:49.12.77.1:5349",VUE_APP_TURN_PASSWORD:"fi",VUE_APP_TURN_URL:"turn:49.12.77.1:5349",VUE_APP_TURN_USER:"brie",VUE_APP_UNSPLASH_API:"",VUE_APP_UNSPLASH_SECRET:"",VUE_APP_VERSION:"2.19.6",BASE_URL:"/"}).VUE_APP_SHOW_USERS,!0)},faae:function(e,t,n){"use strict";n.d(t,"b",(function(){return P})),n.d(t,"a",(function(){return H}));var r=n("5530"),a=n("1da1"),i=(n("96cf"),n("2b3d"),n("d3b7"),n("3ca3"),n("ddb0"),n("841c"),n("ac1f"),n("4ec9"),n("cb29"),n("a434"),n("d81d"),n("159b"),n("a23e"));n("25f0"),n("a9e3"),n("1276"),n("5319");function o(){var e={};return e.connect=function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n,r,a,i){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=n+"://"+r+"/sig/v1/rtc",e.ws=new WebSocket(o+"?room="+a+"&display="+i),e.ws.onmessage=function(t){var n=JSON.parse(t.data),r=e._internals.msgs[n.tid];r?(r.resolve(n.msg),delete e._internals.msgs[n.tid]):e.onmessage(n.msg)},t.abrupt("return",new Promise((function(t,n){e.ws.onopen=function(e){t(e)},e.ws.onerror=function(e){n(e)}})));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r,a){return t.apply(this,arguments)}}(),e.send=function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var a={tid:Number(parseInt((new Date).getTime()*Math.random()*100)).toString(16).substr(0,7),msg:n};e._internals.msgs[a.tid]={resolve:t,reject:r},e.ws.send(JSON.stringify(a))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.close=function(){for(var t in e.ws&&e.ws.close(),e.ws=null,e._internals.msgs){var n=e._internals.msgs[t];n.reject("close")}},e.onmessage=function(e){},e._internals={msgs:{}},e}n("a15b");function s(){var e={};return e.publish=function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n,r){var a,i,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.__internal.prepareUrl(n),r.getTracks().forEach((function(t){e.pc.addTrack(t)})),i={offerToReceiveAudio:1,offerToReceiveVideo:1},t.next=5,e.pc.createOffer(i);case 5:return o=t.sent,t.next=8,e.pc.setLocalDescription(o);case 8:return t.next=10,new Promise((function(e,t){var n={api:a.apiUrl,tid:a.tid,streamurl:a.streamUrl,clientip:null,sdp:o.sdp};$.ajax({type:"POST",url:a.apiUrl,data:JSON.stringify(n),contentType:"application/json",dataType:"json"}).done((function(n){n.code?t(n):e(n)})).fail((function(e){t(e)}))}));case 10:return s=t.sent,t.next=13,e.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:s.sdp}));case 13:return s.simulator=a.schema+"//"+a.urlObject.server+":"+a.port+"/rtc/v1/nack/",t.abrupt("return",s);case 15:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.close=function(){e.pc&&e.pc.close(),e.pc=null},e.onaddstream=function(e){},e.__internal={defaultPath:"/rtc/v1/publish/",prepareUrl:function(t){var n=e.__internal.parse(t),r=n.user_query.schema;r=r?r+":":window.location.protocol;var a=n.port||1985;"https:"===r&&(a=n.port||443);var i=n.user_query.play||e.__internal.defaultPath;for(var o in i.lastIndexOf("/")!==i.length-1&&(i+="/"),s=r+"//"+n.server+":"+a+i,n.user_query)"api"!==o&&"play"!==o&&(s+="&"+o+"="+n.user_query[o]);var s=s.replace(i+"&",i+"?"),c=n.url;return{apiUrl:s,streamUrl:c,schema:r,urlObject:n,port:a,tid:Number(parseInt((new Date).getTime()*Math.random()*100)).toString(16).substr(0,7)}},parse:function(t){var n=document.createElement("a");n.href=t.replace("rtmp://","http://").replace("webrtc://","http://").replace("rtc://","http://");var r=n.hostname,a=n.pathname.substr(1,n.pathname.lastIndexOf("/")-1),i=n.pathname.substr(n.pathname.lastIndexOf("/")+1);if(a=a.replace("...vhost...","?vhost="),a.indexOf("?")>=0){var o=a.substr(a.indexOf("?"));a=a.substr(0,a.indexOf("?")),o.indexOf("vhost=")>0&&(r=o.substr(o.indexOf("vhost=")+"vhost=".length),r.indexOf("&")>0&&(r=r.substr(0,r.indexOf("&"))))}if(n.hostname===r){var s=/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/;s.test(n.hostname)&&(r="__defaultVhost__")}var c="rtmp";t.indexOf("://")>0&&(c=t.substr(0,t.indexOf("://")));var u=n.port;u||("http"===c?u=80:"https"===c?u=443:"rtmp"===c&&(u=1935));var l={url:t,schema:c,server:n.hostname,port:u,vhost:r,app:a,stream:i};return e.__internal.fill_query(n.search,l),l.port||"webrtc"!==c&&"rtc"!==c||("https"===l.user_query.schema||0===window.location.href.indexOf("https://")?l.port=443:l.port=1985),l},fill_query:function(e,t){if(t.user_query={},0!==e.length){e.indexOf("?")>=0&&(e=e.split("?")[1]);for(var n=e.split("&"),r=0;r<n.length;r++){var a=n[r],i=a.split("=");t[i[0]]=i[1],t.user_query[i[0]]=i[1]}t.domain&&(t.vhost=t.domain)}}},e.pc=new RTCPeerConnection(null),e}function c(){var e={};return e.play=function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){var r,a,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.__internal.prepareUrl(n),a={offerToReceiveAudio:1,offerToReceiveVideo:1},t.next=4,e.pc.createOffer(a);case 4:return i=t.sent,t.next=7,e.pc.setLocalDescription(i);case 7:return t.next=9,new Promise((function(e,t){var n={api:r.apiUrl,tid:r.tid,streamurl:r.streamUrl,clientip:null,sdp:i.sdp};$.ajax({type:"POST",url:r.apiUrl,data:JSON.stringify(n),contentType:"application/json",dataType:"json"}).done((function(n){n.code?t(n):e(n)})).fail((function(e){t(e)}))}));case 9:return o=t.sent,t.next=12,e.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:o.sdp}));case 12:return t.abrupt("return",o);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.close=function(){e.pc&&e.pc.close(),e.pc=null},e.onaddstream=function(e){},e.__internal={defaultPath:"/rtc/v1/play/",prepareUrl:function(t){var n=e.__internal.parse(t),r=n.user_query.schema;r=r?r+":":window.location.protocol;var a=n.port||1985;"https:"===r&&(a=n.port||443);var i=n.user_query.play||e.__internal.defaultPath;for(var o in i.lastIndexOf("/")!==i.length-1&&(i+="/"),s=r+"//"+n.server+":"+a+i,n.user_query)"api"!==o&&"play"!==o&&(s+="&"+o+"="+n.user_query[o]);var s=s.replace(i+"&",i+"?"),c=n.url;return{apiUrl:s,streamUrl:c,schema:r,urlObject:n,port:a,tid:Number(parseInt((new Date).getTime()*Math.random()*100)).toString(16).substr(0,7)}},parse:function(t){var n=document.createElement("a");n.href=t.replace("rtmp://","http://").replace("webrtc://","http://").replace("rtc://","http://");var r=n.hostname,a=n.pathname.substr(1,n.pathname.lastIndexOf("/")-1),i=n.pathname.substr(n.pathname.lastIndexOf("/")+1);if(a=a.replace("...vhost...","?vhost="),a.indexOf("?")>=0){var o=a.substr(a.indexOf("?"));a=a.substr(0,a.indexOf("?")),o.indexOf("vhost=")>0&&(r=o.substr(o.indexOf("vhost=")+"vhost=".length),r.indexOf("&")>0&&(r=r.substr(0,r.indexOf("&"))))}if(n.hostname===r){var s=/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/;s.test(n.hostname)&&(r="__defaultVhost__")}var c="rtmp";t.indexOf("://")>0&&(c=t.substr(0,t.indexOf("://")));var u=n.port;u||("http"===c?u=80:"https"===c?u=443:"rtmp"===c&&(u=1935));var l={url:t,schema:c,server:n.hostname,port:u,vhost:r,app:a,stream:i};return e.__internal.fill_query(n.search,l),l.port||"webrtc"!==c&&"rtc"!==c||("https"===l.user_query.schema||0===window.location.href.indexOf("https://")?l.port=443:l.port=1985),l},fill_query:function(e,t){if(t.user_query={},0!==e.length){e.indexOf("?")>=0&&(e=e.split("?")[1]);for(var n=e.split("&"),r=0;r<n.length;r++){var a=n[r],i=a.split("=");t[i[0]]=i[1],t.user_query[i[0]]=i[1]}t.domain&&(t.vhost=t.domain)}}},e.pc=new RTCPeerConnection(null),e.pc.onaddstream=function(t){e.onaddstream&&e.onaddstream(t)},e}var u=n("0a62"),l=(n("a630"),n("b0c0"),n("28b0"));n("34eb")("app:stream");function d(){return p.apply(this,arguments)}function p(){return p=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",navigator.mediaDevices.enumerateDevices());case 4:e.prev=4,e.t0=e["catch"](0),Object(l["d"])(e.t0);case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e,null,[[0,4]])}))),p.apply(this,arguments)}var m={video:{width:1920}},f={echoCancellation:!0,noiseSuppression:!0};function b(e){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(e);var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return new Promise((function(n,r){t?t.call(navigator,e,n,r):r(new Error("Video and audio cannot be accessed. Please try again with another browser or check your browser's settings."))}))}function v(){return h.apply(this,arguments)}function h(){return h=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n,a,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{audio:Object(r["a"])({},f),video:{width:{exact:1280}}},e.prev=1,e.next=5,b(t);case 5:return n=e.sent,e.abrupt("return",{stream:n});case 9:if(e.prev=9,e.t0=e["catch"](1),a=(null===e.t0||void 0===e.t0?void 0:e.t0.name)||(null===e.t0||void 0===e.t0?void 0:e.t0.toString()),"NotAllowedError"!==a){e.next=16;break}return e.abrupt("return",{error:"You denied access to your camera and microphone. Please check your setup."});case 16:if("NotFoundError"!==a){e.next=18;break}return e.abrupt("return",{error:"No camera or microphone has been found!"});case 18:return Object(l["c"])(e.t0),e.abrupt("return",{error:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||(null===e.t0||void 0===e.t0?void 0:e.t0.name)||e.t0.toString()});case 20:case"end":return e.stop()}}),e,null,[[1,9]])}))),h.apply(this,arguments)}function g(e,t){return Array.from(e.getAudioTracks()).forEach((function(t){return e.removeTrack(t)})),t.forEach((function(t){try{e.addTrack(t)}catch(n){"Track has already been added to that stream."!==(null===n||void 0===n?void 0:n.message)&&Object(l["d"])(n)}})),e}var _=n("db49");n("34eb")("app:iframe");for(var w=n("0ab5"),y=n("34eb")("app:state"),S=!1,E=(Object({NODE_ENV:"production",VUE_APP_AUTHOR_EMAIL:"dirk.holtwick@gmail.com",VUE_APP_AUTHOR_NAME:"Dirk Holtwick",VUE_APP_DEBUG_DEFAULT_ROOM:"development",VUE_APP_NAME:"ViMeet",VUE_APP_RELEASE:"ViMeet@2.19.6",VUE_APP_SENTRY_DSN:"",VUE_APP_SHOW_FULLSCREEN:"1",VUE_APP_SHOW_INVITATION:"1",VUE_APP_SHOW_INVITATION_HINT:"1",VUE_APP_SHOW_SETTINGS:"1",VUE_APP_SHOW_SHARE:"1",VUE_APP_SIGNAL_URL:"wss://192.168.1.199:4444",VUE_APP_STUN_URL:"stun:49.12.77.1:5349",VUE_APP_TURN_PASSWORD:"fi",VUE_APP_TURN_URL:"turn:49.12.77.1:5349",VUE_APP_TURN_USER:"brie",VUE_APP_UNSPLASH_API:"",VUE_APP_UNSPLASH_SECRET:"",VUE_APP_VERSION:"2.19.6",BASE_URL:"/"}).VUE_APP_TARGET,new URLSearchParams(window.location.search)),P={room:"",localStream:null,status:{},users:[],peers:[],bandwidth:!1,fill:!0,backgroundMode:"",backgroundImageURL:null,backgroundAuthor:"",backgroundURL:"",ishand:!1,muteVideo:!Object(w["b"])(E.get("video"),!0),muteAudio:!Object(w["b"])(E.get("audio"),!0),mcu:Object(w["b"])(E.get("mcu"),!1),deviceVideo:null,deviceAudio:null,devices:[],svg:{stroke:"1.5"},maximized:"",vapidPublicKey:null,error:null,upgrade:!1,requestBugTracking:!1,embedDemo:!1,showInviteOnStart:Object(w["b"])(E.get("invite"),_["i"]),showInviteHint:Object(w["b"])(E.get("invite"),_["j"]),showFullscreen:Object(w["b"])(E.get("fs"),_["h"]),showSettings:Object(w["b"])(E.get("prefs"),_["k"]),showShare:Object(w["b"])(E.get("share"),_["l"]),showUsers:Object(w["b"])(E.get("users"),_["m"]),sipserver:"",sipusername:"",sippassword:"",apiserver:location.hostname,showWbb:Object(w["b"])(E.get("wbb"),!1),screenshots:S,forwardStreamMap:new Map,refreshMute:null,conference:null,publicationGlobal:null,userListwin:!1,isMaximized:!1,myRoom:"",myUserId:"",myUserNick:"",passWord:"",level:"1",shareVideoUrl:"",shareVideoStream:null,statUpload:0,statDownload:0,playerStream:null,isSpeakMuted:!1,isMicMuted:!1,isCameraMuted:!1,isCamera2Muted:!1,isDesktopShared:!1,isRecordStarted:!1,usedMicrophone:"",usedCamera:"",usedCamera2:"",usedCamera2DeviceId:"",layoutIndex:0,msg_input_visible:!1,msg_content:"",emoji_visible:!1,emoji_data:["emoji_5","emoji_6","emoji_7","emoji_4","emoji_0","emoji_1","emoji_2","emoji_3"],screen_data:[],screen_select_visible:!1,lastMoveTime:0,hideCursorIntervalHandle:null,tools_visible:!0,tools_hover:!1,participants:[],remoteStreams:[],peerConnectionScreen:null,userlist:[]},O=0;O<6;O++)Math.floor(10*Math.random());function U(){try{P.localStream?(P.localStream.getVideoTracks()[0].enabled=!P.muteVideo,P.localStream.getAudioTracks()[0].enabled=!P.muteAudio,P.muteAudio&&P.muteVideo&&I()):P.muteAudio&&P.muteVideo||x()}catch(e){Object(l["c"])(e),console.error("trackException------------"+e)}}function A(){alert("成功！")}function k(){return R.apply(this,arguments)}function R(){return R=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:return e.next=4,x();case 4:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}function I(){return T.apply(this,arguments)}function T(){return T=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P.conference.send({action:"unpublish",room:P.myRoom,display:P.myUserId});case 2:t=e.sent,console.log("unPublishVideo: unpublish ok",t),J();case 5:case"end":return e.stop()}}),e)}))),T.apply(this,arguments)}function x(){return V.apply(this,arguments)}function V(){return V=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n,a,i,o,s,c,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=Object(r["a"])({},f),P.deviceAudio&&(t.deviceId=P.deviceAudio),n=Object(r["a"])({},m),P.deviceVideo&&(n.deviceId=P.deviceVideo),a={audio:t,video:n},c="desktop"===P.deviceVideo,!c){e.next=19;break}return e.next=9,navigator.mediaDevices.getDisplayMedia(a);case 9:return o=e.sent,delete a.video,e.next=13,v(a);case 13:s=e.sent,u=s.stream.getAudioTracks(),o&&(g(o,u),i=o),P.isDesktopShared=!0,e.next=25;break;case 19:return e.next=21,v(a);case 21:s=e.sent,P.error=s.error,i=s.stream,P.isDesktopShared=!1;case 25:return e.next=27,W(P.apiserver+":8806",P.myRoom,P.myUserId,i);case 27:return e.next=29,P.conference.send({action:"publish",room:P.myRoom,display:P.myUserId});case 29:l=e.sent,console.log("publishVideo: publish ok",l);case 31:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}P.myRoomId=P.myRoom=P.room=E.get("roomid")?E.get("roomid"):"5ffe1d7babd85a0fa64755f8",E.get("username")||(location.href="./login.html"),P.myUserId=E.get("username"),P.myUserNick=P.myUserId,P.sipserver="rtmp://127.0.0.1:1937/live/"+P.myUserId,P.passWord=E.get("password")?E.get("password"):"1234",E.get("level")&&"on"==E.get("level")?P.level=0:P.level=1,P.mcu&&(P.fill=!1),i["b"].on("requestBugTracking",(function(e){return P.requestBugTracking=!0})),i["b"].on("upgrade",(function(e){return P.upgrade=!0})),i["b"].on("updateStream",U),i["b"].on("setSipUser",A),i["b"].on("switchMedia",k);function N(e){for(var t=0,n=0;n<P.users.length;++n)if(P.users[n]&&P.users[n].id===e){t=n;break}P.users[t].userId==P.myUserId&&alert("kill me!"),P.users.splice(t,1)}function j(e){for(var t=0,n=0;n<P.peers.length;++n)if(P.peers[n]&&P.peers[n].userId===e){t=n,P.peers[n].player.close();break}P.peers[t].userId==P.myUserId&&alert("kill me peer!"),P.peers.splice(t,1)}function L(e){for(var t=0;t<P.userlist.length;++t)if(P.userlist[t]&&P.userlist[t].user_name===e)return P.userlist[t].ishand;return!1}function M(e){for(var t=0;t<P.userlist.length;++t)if(P.userlist[t]&&P.userlist[t].user_name===e)return P.userlist[t].muteaudio;return!1}function D(e){for(var t=0;t<P.userlist.length;++t)if(P.userlist[t]&&P.userlist[t].user_name===e)return P.userlist[t].mutevideo;return!1}function H(){P.isMicMuted=!0,P.isCameraMuted=!0,P.isCamera2Muted=!0,P.isDesktopShared=!1,P.isRecordStarted=!1,P.wsclient=Object(u["k"])(P.myRoom,P.myUserId,P.myUserNick,P.passWord,P.level),P.wsclient.wsmsg.addEventListener("login",function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return document.getElementById("iframeWbb").contentWindow.document.getElementById("pagetext").value="1/1",t.detail.user_name==P.myUserId&&(P.userlist=t.detail.userlist),console.log(P.myRoom,"------",P.myUserId,P.level),P.conference=new o,P.conference.onmessage=function(e){e.peer.display!==P.myUserId&&("publish"===e.event&&e.peer&&e.peer.publishing&&G(P.apiserver+":8806",P.myRoom,e.peer.display),"unpublish"===e.event&&j(e.peer.display),"control"===e.event&&"message"===e.param&&(e.data=JSON.parse(e.data),"msg_text"!=e.data.type&&"msg_emoji"!=e.data.type||(e.data.userId=e.peer.display,i["b"].emit("sendMessage",e.data))),"join"===e.event&&P.users.push({id:e.peer.display,userId:e.peer.display,nackname:e.peer.display==P.myUserId?e.peer.display+"(本人)":e.peer.display,level:e.peer.level,ishand:L(e.peer.display),muteaudio:M(e.peer.display),mutevideo:D(e.peer.display),shareScreenStream:!1}),"leave"===e.event&&(N(e.peer.display),j(e.peer.display)))},e.next=7,P.conference.connect("wss",P.apiserver+":8806",P.myRoom,P.myUserId);case 7:return e.next=9,P.conference.send({action:"join",room:P.myRoom,display:P.myUserId});case 9:return n=e.sent,e.next=12,v();case 12:if(r=e.sent,a=r.stream,s=r.error,P.error=s,!a){e.next=25;break}return e.next=19,d();case 19:if(e.t0=e.sent,e.t0){e.next=22;break}e.t0=[];case 22:P.devices=e.t0.map((function(e){var t;return y("found device",e),{kind:(null===e||void 0===e||null===(t=e.kind)||void 0===t?void 0:t.toLowerCase())||"?",deviceId:null===e||void 0===e?void 0:e.deviceId,label:e.label||"Unknown name"}})),e.next=26;break;case 25:console.error("Media error",s);case 26:return e.next=28,W(P.apiserver+":8806",P.myRoom,P.myUserId,a);case 28:return e.next=30,P.conference.send({action:"publish",room:P.myRoom,display:P.myUserId});case 30:e.sent,n.participants.forEach((function(e){P.users.push({id:e.display,userId:e.display,nackname:e.display==P.myUserId?e.display+"(本人)":e.display,level:e.level,ishand:L(e.display),muteaudio:M(e.display),mutevideo:D(e.display),shareScreenStream:!1}),e.display!==P.myUserId&&e.publishing&&G(P.apiserver+":8806",P.myRoom,e.display)}));case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),P.wsclient.wsmsg.addEventListener("adduserlist",(function(e){e.detail.user_name!==P.myUserId&&P.userlist.push(e.detail)})),P.wsclient.wsmsg.addEventListener("alert",(function(e){alert(e.detail.info),location.href="./login.html"})),P.wsclient.wsmsg.addEventListener("usermute",(function(e){for(var t=0;t<P.users.length;++t)if(P.users[t]&&P.users[t].userId===e.detail.user_name){P.users[t].muteaudio=e.detail.muteaudio,P.users[t].mutevideo=e.detail.mutevideo;break}for(t=0;t<P.userlist.length;++t)if(P.userlist[t]&&P.userlist[t].user_name===e.detail.user_name){P.userlist[t].muteaudio=e.detail.muteaudio,P.userlist[t].mutevideo=e.detail.mutevideo;break}e.detail.user_name==P.myUserId&&(P.muteVideo=e.detail.mutevideo,P.muteAudio=e.detail.muteaudio,i["b"].emit("updateStream"))})),P.wsclient.wsmsg.addEventListener("userhand",(function(e){for(var t=0;t<P.users.length;++t)if(P.users[t]&&P.users[t].userId===e.detail.user_name){P.users[t].ishand=e.detail.ishand;break}for(t=0;t<P.userlist.length;++t)if(P.userlist[t]&&P.userlist[t].user_name===e.detail.user_name){P.userlist[t].ishand=e.detail.ishand;break}e.detail.user_name==P.myUserId&&(P.ishand=e.detail.ishand)})),P.wsclient.wsmsg.addEventListener("get_top_list",(function(e){for(var t=0;t<e.detail.top_list.length;t++){var n=e.detail.top_list[t];"canvas"==n.opId&&document.getElementById("iframeWbb").contentWindow.reOpmessage(n)}})),P.wsclient.wsmsg.addEventListener("set_topfile",(function(e){var t=e.detail;"OPEN"==t.optype&&(P.openfileurl=t.topfile,P.pageNum=parseInt(t.topfilepage),document.getElementById("iframeWbb").contentWindow.openfile11(P.openfileurl,P.pageNum)),"RESET"==t.optype&&document.getElementById("iframeWbb").contentWindow.filereset(),"PageNum"==t.optype&&(""==P.openfileurl?(P.openfileurl=t.topfile,P.pageNum=parseInt(t.topfilepage),document.getElementById("iframeWbb").contentWindow.openfile11(P.openfileurl,P.pageNum)):(P.pageNum=parseInt(t.topfilepage),document.getElementById("iframeWbb").contentWindow.goPage(P.pageNum)))})),P.wsclient.wsmsg.addEventListener("draw_message",(function(e){"canvas"==e.detail.opId&&document.getElementById("iframeWbb").contentWindow.reOpmessage(e.detail)})),P.wsclient.wsmsg.addEventListener("disconnect",(function(e){var t=0;console.log("disconnect->",e.detail);for(var n=0;n<P.userlist.length;++n)if(P.userlist[n]&&P.userlist[n].user_name===e.detail.user_name){t=n,P.userlist.splice(t,1);break}e.detail.user_name==P.myUserId&&z()}))}var W=function(e,t,n,r){var a="webrtc://"+e+"/"+t+"/"+n;return P.publicationGlobal&&P.publicationGlobal.close(),P.localStream=r,P.localStream.getVideoTracks()[0].enabled=!P.muteVideo,P.localStream.getAudioTracks()[0].enabled=!P.muteAudio,P.publicationGlobal=new s,P.publicationGlobal.publish(a,r).then((function(e){})).catch((function(e){P.publicationGlobal.close(),console.error(e)}))},G=function(e,t,n){var r=new c,a="webrtc://"+e+"/"+t+"/"+n,i={};i.remote=n,i.stream=null,i.mutevideo=!0,i.player=r,i.userId=n,i.fingerprint=n,P.peers.push(i),r.onaddstream=function(e){i.stream=e.stream},r.play(a).then((function(e){})).catch((function(e){j(n),console.error(e)}))};function C(e){return q.apply(this,arguments)}function q(){return q=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:P.isDesktopShared?P.deviceVideo=null:P.deviceVideo="desktop";case 1:case"end":return e.stop()}}),e)}))),q.apply(this,arguments)}function B(){if(P.sipserver)if(P.isRecordStarted){Object(u["i"])(P.sipserver,(function(){}),"https://"+P.apiserver+":8806"),P.isRecordStarted=!1;var e={type:"msg_text"};e.content="直播推流:"+P.sipserver+"停止！",e.userId=P.myUserId,i["b"].emit("sendMessage",e)}else{var t="rtmp://127.0.0.1:1937/"+P.myRoom+"/"+P.myUserId,n=P.myUserId,r="RTMP";Object(u["g"])(t,n,P.sipserver,r,(function(){}),"https://"+P.apiserver+":8806"),P.isRecordStarted=!0;var a={type:"msg_text"};a.content="直播推流:"+P.sipserver+"开始！",a.userId=P.myUserId,i["b"].emit("sendMessage",a)}else alert("推流地址不能为空！")}function J(){P.localStream&&F(P.localStream),P.localStream=null;try{P.publicationGlobal&&P.publicationGlobal.close(),P.publicationGlobal=null}catch(e){}}function F(e){if(e)try{e.getTracks().forEach((function(t){t.stop(),e.removeTrack(t)})),e=null}catch(t){console.error(t)}finally{e=null}}function z(e){P.conference&&P.conference.close(),P.conference=null,P.localStream&&P.localStream&&F(P.localStream),P.localStream=null,P.publicationGlobal&&P.publicationGlobal.close(),P.publicationGlobal=null,P.wsclient&&P.wsclient.disconnect(),P.wsclient=null;for(var t=0;t<P.peers.length;++t)P.peers[t].player.close();P.ScreenStream&&P.ScreenStream&&F(P.ScreenStream),P.ScreenStream=null,P.mixStreamGlobal&&P.mixStreamGlobal&&F(P.mixStreamGlobal),P.mixStreamGlobal=null,P.publicationGlobalSecond&&P.publicationGlobalSecond.close(),P.publicationGlobalSecond=null,P.publicationScreenGlobal&&P.publicationScreenGlobal.close(),P.publicationScreenGlobal=null,location.href="./login.html",P.playerStream=null,P.statInterval&&(clearInterval(P.statInterval),P.statInterval=0),P.refreshMute&&(clearInterval(P.refreshMute),P.refreshMute=0)}window.opmessageSend=function(e){var t=new Date,n=t.getTime();e.type="draw_message",e.opId="canvas",e.opTime=n+"",e.userName=P.myUserId,P.wsclient.send(e)},window.fileMsgSend=function(e,t){var n={topfile:P.openfileurl,type:"set_topfile",optype:e,user_name:P.myUserId,topfilepage:t};P.wsclient.send(n)},window.closeWbbFile=function(e){P.openfileurl==e&&fileMsgSend("RESET","")},window.openWbbFile=function(e){P.wsclient.send(e)},window.setVideoLayout=function(e){console.log(e),P.mixStreamGlobal&&Object(u["d"])(P.myRoomId,P.mixStreamGlobal.id,e)},window.setActiveLayout=function(e){Object(u["c"])(P.myRoomId,e,P.mixStreamGlobal.id)},window.shareVideo=function(e,t,n,r,a){var i="rtmp://127.0.0.1:1937/"+r+"/"+a;Object(u["g"])(e,t,i,n,(function(e){console.log("startLiveUrl->",e),Object(u["h"])(r,a,"https://"+P.apiserver+":8806")}),"https://"+P.apiserver+":8806")},window.closeshareVideo=function(e,t){var n="rtmp://127.0.0.1:1937/"+e+"/"+t;Object(u["j"])(e,t,"https://"+P.apiserver+":8806"),Object(u["i"])(n,(function(){}),"https://"+P.apiserver+":8806")},i["b"].on("desktopShared",C),i["b"].on("liveRecord",B),i["b"].on("closeStream",J),i["b"].on("exitRoom",z),window.onunload=function(e){z(e)},window.onbeforeunload=function(e){z(e)},window.addEventListener("popstate",(function(e){alert("确认退出会议！"),z(e)}),!1)}});
//# sourceMappingURL=index.9340410d.js.map